<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Chatbot Test</title>
    <meta name="chatbot-tenant-id" content="687d104974f2f8e6e27e032e" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .debug {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .error {
        background: #ffe6e6;
        border: 1px solid #ff9999;
      }
      .success {
        background: #e6ffe6;
        border: 1px solid #99ff99;
      }
    </style>
  </head>
  <body>
    <h1>Chatbot Debug Test</h1>
    <div id="debug-output"></div>

    <h2>Manual Tests:</h2>
    <button onclick="testTenantId()">Test: Get Tenant ID</button>
    <button onclick="testInitAPI()">Test: Init API</button>
    <button onclick="testEmbedScript()">Test: Load Embed Script</button>

    <script>
      const debugOutput = document.getElementById("debug-output");

      function log(message, type = "debug") {
        const div = document.createElement("div");
        div.className = `debug ${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        debugOutput.appendChild(div);
        console.log(message);
      }

      function testTenantId() {
        const tenantMeta = document.querySelector(
          'meta[name="chatbot-tenant-id"]'
        );
        if (tenantMeta) {
          const tenantId = tenantMeta.getAttribute("content");
          log(`‚úÖ Tenant ID found: ${tenantId}`, "success");
        } else {
          log("‚ùå Tenant ID meta tag not found", "error");
        }
      }

      async function testInitAPI() {
        try {
          const tenantMeta = document.querySelector(
            'meta[name="chatbot-tenant-id"]'
          );
          const tenantId = tenantMeta.getAttribute("content");

          const response = await fetch("/api/chatbot/init", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              tenantId: tenantId,
              domain: window.location.hostname,
            }),
          });

          if (response.ok) {
            const data = await response.json();
            log(
              `‚úÖ Init API success: ${data.success}, token: ${
                data.token ? "received" : "missing"
              }`,
              "success"
            );
          } else {
            log(
              `‚ùå Init API failed: ${response.status} ${response.statusText}`,
              "error"
            );
          }
        } catch (error) {
          log(`‚ùå Init API error: ${error.message}`, "error");
        }
      }

      function testEmbedScript() {
        log("üöÄ Loading embed script...", "debug");

        const script = document.createElement("script");
        script.src = "/embed";
        script.onload = () =>
          log("‚úÖ Embed script loaded successfully", "success");
        script.onerror = () => log("‚ùå Embed script failed to load", "error");

        document.head.appendChild(script);
      }

      // Auto-run tests on page load
      window.onload = () => {
        log("üîç Starting debug tests...", "debug");
        testTenantId();
        setTimeout(testInitAPI, 1000);
        setTimeout(testEmbedScript, 2000);
      };
    </script>
  </body>
</html>
